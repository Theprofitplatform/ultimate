<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hive System Monitoring Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 15px;
        }
        
        .status-healthy {
            background: #10b981;
            color: white;
        }
        
        .status-warning {
            background: #f59e0b;
            color: white;
        }
        
        .status-error {
            background: #ef4444;
            color: white;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .metric-label {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 20px;
            color: #333;
            font-weight: 600;
        }
        
        .time-range {
            display: flex;
            gap: 10px;
        }
        
        .time-btn {
            padding: 5px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .time-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .agent-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .agent-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .agent-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-online {
            background: #10b981;
        }
        
        .status-offline {
            background: #ef4444;
        }
        
        .status-busy {
            background: #f59e0b;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }
        
        .agent-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .agent-stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
        }
        
        .logs-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .log-filters {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 5px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .logs-list {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            background: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-time {
            color: #666;
            margin-right: 10px;
        }
        
        .log-level-info {
            color: #3b82f6;
        }
        
        .log-level-warn {
            color: #f59e0b;
        }
        
        .log-level-error {
            color: #ef4444;
        }
        
        .chart-canvas {
            width: 100%;
            height: 300px;
            background: #f8f9fa;
            border-radius: 5px;
            position: relative;
        }
        
        .chart-line {
            stroke: #667eea;
            stroke-width: 2;
            fill: none;
        }
        
        .chart-area {
            fill: rgba(102, 126, 234, 0.1);
        }
        
        .refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="refresh-indicator">
        <div class="spinner"></div>
        <span>Auto-refresh: 5s</span>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>
                üêù Hive System Monitoring
                <span id="system-status" class="status-badge status-healthy">HEALTHY</span>
            </h1>
            <p style="color: #666; margin-top: 10px;">
                Real-time monitoring and analytics for distributed agent system
            </p>
        </div>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="active-agents">0</div>
                <div class="metric-label">Active Agents</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="tasks-processed">0</div>
                <div class="metric-label">Tasks Processed</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="queue-length">0</div>
                <div class="metric-label">Queue Length</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="uptime">0h</div>
                <div class="metric-label">System Uptime</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="cpu-usage">0%</div>
                <div class="metric-label">CPU Usage</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="memory-usage">0MB</div>
                <div class="metric-label">Memory Usage</div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">Task Processing Rate</div>
                <div class="time-range">
                    <button class="time-btn active" data-range="1h">1H</button>
                    <button class="time-btn" data-range="6h">6H</button>
                    <button class="time-btn" data-range="24h">24H</button>
                    <button class="time-btn" data-range="7d">7D</button>
                </div>
            </div>
            <svg class="chart-canvas" id="task-chart">
                <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:#667eea;stop-opacity:0" />
                    </linearGradient>
                </defs>
            </svg>
        </div>
        
        <div class="agents-grid" id="agents-grid">
            <!-- Agent cards will be dynamically inserted here -->
        </div>
        
        <div class="logs-container">
            <div class="logs-header">
                <div class="chart-title">System Logs</div>
                <div class="log-filters">
                    <button class="filter-btn active" data-level="all">All</button>
                    <button class="filter-btn" data-level="info">Info</button>
                    <button class="filter-btn" data-level="warn">Warning</button>
                    <button class="filter-btn" data-level="error">Error</button>
                </div>
            </div>
            <div class="logs-list" id="logs-list">
                <!-- Logs will be dynamically inserted here -->
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:9090/api';
        const WS_URL = 'ws://localhost:9092';
        
        let ws;
        let chartData = [];
        let systemStartTime = Date.now();
        
        // Initialize WebSocket connection
        function initWebSocket() {
            ws = new WebSocket(WS_URL);
            
            ws.onopen = () => {
                console.log('WebSocket connected');
                document.getElementById('system-status').className = 'status-badge status-healthy';
                document.getElementById('system-status').textContent = 'HEALTHY';
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleRealtimeUpdate(data);
            };
            
            ws.onerror = () => {
                document.getElementById('system-status').className = 'status-badge status-error';
                document.getElementById('system-status').textContent = 'ERROR';
            };
            
            ws.onclose = () => {
                document.getElementById('system-status').className = 'status-badge status-warning';
                document.getElementById('system-status').textContent = 'DISCONNECTED';
                setTimeout(initWebSocket, 5000);
            };
        }
        
        // Handle real-time updates
        function handleRealtimeUpdate(data) {
            if (data.type === 'task-completed') {
                incrementTaskCount();
                addLogEntry('info', `Task ${data.taskId} completed by ${data.agent}`);
            } else if (data.type === 'agent-status') {
                updateAgentStatus(data.agentId, data.status);
            } else if (data.type === 'system-metrics') {
                updateMetrics(data.metrics);
            }
        }
        
        // Fetch system status
        async function fetchStatus() {
            try {
                const response = await fetch(`${API_URL}/status`);
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error('Failed to fetch status:', error);
                document.getElementById('system-status').className = 'status-badge status-error';
                document.getElementById('system-status').textContent = 'ERROR';
            }
        }
        
        // Update dashboard with status data
        function updateDashboard(data) {
            // Update metrics
            document.getElementById('active-agents').textContent = data.agents?.length || 0;
            document.getElementById('tasks-processed').textContent = data.tasksProcessed || 0;
            document.getElementById('queue-length').textContent = data.queueLength || 0;
            
            // Update uptime
            const uptime = Date.now() - systemStartTime;
            const hours = Math.floor(uptime / 3600000);
            const minutes = Math.floor((uptime % 3600000) / 60000);
            document.getElementById('uptime').textContent = `${hours}h ${minutes}m`;
            
            // Update agents grid
            updateAgentsGrid(data.agents || []);
            
            // Add sample chart data
            updateChart();
        }
        
        // Update agents grid
        function updateAgentsGrid(agents) {
            const grid = document.getElementById('agents-grid');
            grid.innerHTML = '';
            
            agents.forEach(agent => {
                const card = document.createElement('div');
                card.className = 'agent-card';
                card.innerHTML = `
                    <div class="agent-header">
                        <div class="agent-name">${agent.name || agent.id}</div>
                        <div class="agent-status ${agent.status === 'ready' ? 'status-online' : 'status-offline'}"></div>
                    </div>
                    <div class="agent-stats">
                        <div class="agent-stat">
                            <div class="stat-value">${agent.tasksCompleted || 0}</div>
                            <div class="stat-label">Completed</div>
                        </div>
                        <div class="agent-stat">
                            <div class="stat-value">${agent.tasksInProgress || 0}</div>
                            <div class="stat-label">In Progress</div>
                        </div>
                        <div class="agent-stat">
                            <div class="stat-value">${agent.successRate || 100}%</div>
                            <div class="stat-label">Success Rate</div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        // Update chart
        function updateChart() {
            const chart = document.getElementById('task-chart');
            const width = chart.clientWidth;
            const height = chart.clientHeight;
            const padding = 40;
            
            // Generate sample data
            const points = 20;
            const data = Array.from({length: points}, (_, i) => ({
                x: (width - padding * 2) / points * i + padding,
                y: height - padding - Math.random() * (height - padding * 2)
            }));
            
            // Create path
            const pathData = data.map((p, i) => 
                `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`
            ).join(' ');
            
            const areaData = pathData + ` L ${width - padding} ${height - padding} L ${padding} ${height - padding} Z`;
            
            chart.innerHTML = `
                <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:#667eea;stop-opacity:0" />
                    </linearGradient>
                </defs>
                <path d="${areaData}" fill="url(#gradient)" />
                <path d="${pathData}" class="chart-line" />
            `;
        }
        
        // Add log entry
        function addLogEntry(level, message) {
            const logsList = document.getElementById('logs-list');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const time = new Date().toLocaleTimeString();
            entry.innerHTML = `
                <span class="log-time">${time}</span>
                <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                <span>${message}</span>
            `;
            
            logsList.insertBefore(entry, logsList.firstChild);
            
            // Keep only last 50 entries
            while (logsList.children.length > 50) {
                logsList.removeChild(logsList.lastChild);
            }
        }
        
        // Increment task count
        function incrementTaskCount() {
            const element = document.getElementById('tasks-processed');
            const current = parseInt(element.textContent) || 0;
            element.textContent = current + 1;
        }
        
        // Update agent status
        function updateAgentStatus(agentId, status) {
            // Find and update agent card
            const agentCards = document.querySelectorAll('.agent-card');
            agentCards.forEach(card => {
                const nameElement = card.querySelector('.agent-name');
                if (nameElement && nameElement.textContent.includes(agentId)) {
                    const statusElement = card.querySelector('.agent-status');
                    statusElement.className = `agent-status ${status === 'ready' ? 'status-online' : status === 'busy' ? 'status-busy' : 'status-offline'}`;
                }
            });
        }
        
        // Update system metrics
        function updateMetrics(metrics) {
            if (metrics.cpu) {
                document.getElementById('cpu-usage').textContent = `${metrics.cpu}%`;
            }
            if (metrics.memory) {
                document.getElementById('memory-usage').textContent = `${metrics.memory}MB`;
            }
        }
        
        // Simulate some activity
        function simulateActivity() {
            // Add sample log entries
            const logTypes = [
                { level: 'info', message: 'System health check completed' },
                { level: 'info', message: 'Agent registered: backend-agent' },
                { level: 'warn', message: 'High memory usage detected' },
                { level: 'info', message: 'Task queue processed successfully' },
                { level: 'error', message: 'Failed to connect to external API' },
                { level: 'info', message: 'Cache cleared successfully' }
            ];
            
            const randomLog = logTypes[Math.floor(Math.random() * logTypes.length)];
            addLogEntry(randomLog.level, randomLog.message);
            
            // Update CPU and memory
            document.getElementById('cpu-usage').textContent = `${Math.floor(Math.random() * 60 + 20)}%`;
            document.getElementById('memory-usage').textContent = `${Math.floor(Math.random() * 500 + 200)}MB`;
        }
        
        // Initialize dashboard
        function init() {
            initWebSocket();
            fetchStatus();
            
            // Set up refresh intervals
            setInterval(fetchStatus, 5000);
            setInterval(simulateActivity, 3000);
            
            // Set up time range buttons
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    updateChart();
                });
            });
            
            // Set up log filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    // Filter logic would go here
                });
            });
            
            // Initial log entries
            addLogEntry('info', 'Dashboard initialized');
            addLogEntry('info', 'Connected to Hive orchestrator');
            addLogEntry('info', 'Monitoring started');
        }
        
        // Start when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>